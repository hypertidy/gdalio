<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Read Data to via GDAL Warper to an Assumed Grid • gdalio</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Read Data to via GDAL Warper to an Assumed Grid">
<meta property="og:description" content="Convenience wrapper for the GDAL raster warper library. Set a default context grid, an extent, 
 dimension, projection, and then read any GDAL raster source into that grid. There are controls to augment
 metadata-poor sources (to override missing or incorrect extent or projection metadata), to set a desired grid
 for subsequent use, and ability to control options available by the GDAL warp library itself. This can be 
 used to easily read data from any kind of raster data source, local files, online servers, bare URLs, and database
 connections. Data is read in generic form but we provide example wrappers for commonly used formats for raster
 data. ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">gdalio</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.1.9014</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/examples-microsoft.html">examples-microsoft</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hypertidy/gdalio/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="gdalio">gdalio<a class="anchor" aria-label="anchor" href="#gdalio"></a>
</h1></div>
<!-- badges: start -->
<p>The goal of gdalio is to read data direct with GDAL warp, with a simple configuration - specify the <em>target grid</em> once. This saves us from a lot of complication, juggling of formats, objects, and extra code.</p>
<p>We have these functions to easily read raster data via the GDAL warp library:</p>
<ul>
<li><p><code><a href="reference/gdalio_data.html">gdalio_data()</a></code> read data directly from a <em>data source name</em> i.e. file path, url, or database connection</p></li>
<li><p><code><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid()</a></code> specify a grid (extent, dimension, projection) to use for all subsequent operations</p></li>
<li><p><code><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid()</a></code> get the grid currently in use</p></li>
<li><p><code><a href="reference/vrt.html">vrt()</a></code> simple function (not actually VRT, but doing similar in a limited way) to <em>augment</em> data sources that have missing or incorrect <em>extent</em> or <em>projection</em> metadata</p></li>
<li><p><code><a href="reference/gdalio_data.html">gdalio_matrix()</a></code>, <code><a href="reference/gdalio_data.html">gdalio_array()</a></code>, and <code><a href="reference/gdalio_data.html">gdalio_graphics()</a></code> which reformat the data into commonly used R types for images</p></li>
<li><p><code><a href="reference/gdalio_data_rgb.html">gdalio_data_hex()</a></code>, <code><a href="reference/gdalio_data_rgb.html">gdalio_data_rgb()</a></code> special cases of gdalio_data() to read 3 or 4 bands, convert to text hex codes</p></li>
<li><p><code><a href="reference/gdalio_local_grid.html">gdalio_local_grid()</a></code> a helper to create a local projected region around a longlat (optional width extent, dimension, projection family)</p></li>
<li><p><code><a href="reference/gdalio_format_source.html">gdalio_format_source()</a></code> a helper to <em>print out the code you can run</em> to define formatters for spatial package types (raster, stars, terra, spatstat).</p></li>
</ul>
<p>In this readme we illustrate the use of these from some online and local raster data sources, and provide helpers for reading into particular formats used in R (base matrix, raster package, stars package, spatstat package, terra package).</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install gdalio with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#install.packages("remotes")</span>
<span class="co">## currently need this branch to avoid dev problems in vapour</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"hypertidy/vapour@stable-2022"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"hypertidy/gdalio"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="target-grid-specification">Target grid specification<a class="anchor" aria-label="anchor" href="#target-grid-specification"></a>
</h2>
<p>Key is having a <em>target grid</em>, we nominate it upfront and then any data we request from GDAL will <em>fill that grid</em> by GDAL’s warp magic.</p>
<p>A <em>grid</em> is an abstract description of an <em>image</em> data set:</p>
<ul>
<li>extent <code>(xmin, xmax, ymin, ymax)</code> in some coordinate system</li>
<li>dimension (number of columns, number of rows)</li>
<li>projection - the actual coordinate system</li>
</ul>
<p>Often we have an actual object in some format that records this information, but this can be much simpler by working with just 6 numbers and one character string.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This works best for data you have access to locally, and in the simplest case you could use gdalio like this, but more nuanced use requires some effort to define the structure of the output data (which we explore below).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/gdalio" class="external-link">gdalio</a></span><span class="op">)</span>
<span class="va">vals</span> <span class="op">&lt;-</span> <span class="fu">gdal_data</span><span class="op">(</span><span class="st">"myhugefile.tif"</span><span class="op">)</span></code></pre></div>
<p>For a real example we use a file that’s on the internet and requires a little extra prep.</p>
<p>A sea surface temperature data set, we need GDAL’s subdataset syntax for a file at a URL and <em>augment</em> our file address with what we know is the projection of the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/gdalio" class="external-link">gdalio</a></span><span class="op">)</span>

<span class="co">## online data, daily ocean temperature surface product, one layer in longlat 0.25 degree res</span>
<span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/vrt.html">vrt</a></span><span class="op">(</span><span class="st">'NETCDF:"/vsicurl/https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/201809/oisst-avhrr-v02r01.20180929.nc":sst'</span>, 
         projection <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## we set up a grid (this is a *raster* in abstraction)</span>
<span class="va">grid0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1e6</span>, <span class="fl">1e6</span>, <span class="op">-</span><span class="fl">5e5</span>, <span class="fl">5e5</span> <span class="op">)</span>, 
                             dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>, <span class="fl">256</span><span class="op">)</span>, 
                             projection <span class="op">=</span> <span class="st">"+proj=laea +lon_0=147 +lat_0=-42"</span><span class="op">)</span>
<span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="va">grid0</span><span class="op">)</span></code></pre></div>
<p>And now start reading data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## then we get GDAL to get a value for every pixel in our grid</span>
<span class="va">pix</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>  
<span class="co">## we have a list vector for each band (just one here)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pix</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, pch <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-warp-1.png" width="100%"></p>
<p>Those look a little simplified (it’s because we are asking for quite high resolution from a low resolution source). So let’s use a different <em>resampling</em> algorithm (default is nearest neighbour, no interpolation).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pix_interp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">f</span>, resample <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span>  
<span class="co">## use resampling we get quite a different result</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pix_interp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, pch <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-bilinear-1.png" width="100%"></p>
<p>Normally of course we want a bit more convenience, and actually fill a format in R or some package that has spatial types. So we define those helpers here.</p>
</div>
<div class="section level2">
<h2 id="raster-formats">Raster formats<a class="anchor" aria-label="anchor" href="#raster-formats"></a>
</h2>
<p>This function is equivalent to a number of others defined just below, to format the data into objects used by various packages.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## simple list format used by graphics::image() - we can only handle one band/layer</span>
<span class="va">gdalio_base</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
   <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span><span class="op">)</span>
   <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid</a></span><span class="op">(</span><span class="op">)</span>
   <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, length.out <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
        z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">v</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span>, <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>R for a long time had this powerful list(x,y,z) format for <code><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">xyz</span> <span class="op">&lt;-</span> <span class="fu">gdalio_base</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">xyz</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-image-1.png" width="100%"></p>
<p>There are now several different formats used by various packages that are equivalent. At root they specify <em>extent</em>, <em>dimension</em>, <em>projection</em> the core concepts of our <em>target grid</em> (the less specialized ones ignore the projection). Some of these kinds of functions require those format-specific packages, but they are easy enough to write so we list these here as examples.</p>
<p>There are functions <code><a href="reference/gdalio_data.html">gdalio_matrix()</a></code>, <code><a href="reference/gdalio_data.html">gdalio_array()</a></code>, and <code><a href="reference/gdalio_data.html">gdalio_graphics()</a></code> in this package that put the data into the native R image form.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## {spatstat.geom}</span>
<span class="va">gdalio_im</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, <span class="va">band_output_type</span> <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, band_output_type  <span class="op">=</span> <span class="va">band_output_type</span><span class="op">)</span>
  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid</a></span><span class="op">(</span><span class="op">)</span>
  <span class="co">## can we have a list of im?</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"only returning one image layer im, for now"</span><span class="op">)</span>
  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">v</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
  <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu">im</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, xrange <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, yrange <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## {raster}</span>
<span class="va">gdalio_raster</span> <span class="op">&lt;-</span>
<span class="kw">function</span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, <span class="va">band_output_type</span> <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, band_output_type  <span class="op">=</span> <span class="va">band_output_type</span><span class="op">)</span>
  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu">raster</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu">extent</span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">)</span>, nrows <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ncols <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, crs <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">projection</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu">brick</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span>, <span class="va">r</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu">setValues</span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">v</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## {terra}</span>
<span class="va">gdalio_terra</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, <span class="va">band_output_type</span> <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, band_output_type  <span class="op">=</span> <span class="va">band_output_type</span><span class="op">)</span>
  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu">rast</span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu">ext</span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">)</span>, nrows <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ncols <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, crs <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">projection</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu">nlyr</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span>
  <span class="fu">terra</span><span class="fu">::</span><span class="fu">setValues</span><span class="op">(</span><span class="va">r</span>, <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cbind</span>, <span class="va">v</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## {stars}</span>
<span class="va">gdalio_stars</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, <span class="va">band_output_type</span> <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_data</a></span><span class="op">(</span><span class="va">dsn</span>, <span class="va">...</span>, band_output_type  <span class="op">=</span> <span class="va">band_output_type</span><span class="op">)</span>
  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">aa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">v</span>, use.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="co">#[,g$dimension[2]:1, , drop = FALSE]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="va">aa</span> <span class="op">&lt;-</span> <span class="va">aa</span><span class="op">[</span>,,<span class="fl">1</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>
  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">stars</span><span class="fu">::</span><span class="fu">st_as_stars</span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu">st_bbox</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ymin <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymax <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,
                          nx <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, ny <span class="op">=</span> <span class="va">g</span><span class="op">$</span><span class="va">dimension</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, values <span class="op">=</span> <span class="va">aa</span><span class="op">)</span>

  <span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu">st_set_crs</span><span class="op">(</span><span class="va">r</span>, <span class="va">g</span><span class="op">$</span><span class="va">projection</span><span class="op">)</span>
  <span class="va">r</span>
<span class="op">}</span></code></pre></div>
<p>To obtain all of those functions you can do, but note the entire dependency requirement includes at least raster, stars, spatstat.geom, terra, so simply use the definitions as needed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="reference/gdalio_format_source.html">gdalio_format_source</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; source(system.file("raster_format/raster_format.codeR", package = "gdalio", mustWork = TRUE))</span></code></pre></div>
<p>Note that for each format there is nothing of consequence that is different, from the perspective of gdalio they all take the same set of pixel values, there are just tiny differences in how the extent and projection metadata are handled, and in storage orientation for the data itself.</p>
<p>To prove the point we now read the same data but into our format of choice. We are <em>re-reading</em> data here (it all exists in <code>pix</code> above, but you get the idea).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#plot(matrix(g$extent, ncol = 2), type = "n", asp = 1, xlab = "x", ylab = "y", main = "stars")</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu">gdalio_stars</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"stars"</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 methods overwritten by 'stars':</span>
<span class="co">#&gt;   method             from</span>
<span class="co">#&gt;   st_bbox.SpatExtent sf  </span>
<span class="co">#&gt;   st_bbox.SpatRaster sf  </span>
<span class="co">#&gt;   st_bbox.SpatVector sf  </span>
<span class="co">#&gt;   st_crs.SpatRaster  sf  </span>
<span class="co">#&gt;   st_crs.SpatVector  sf</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="fu">gdalio_raster</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">26</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"raster"</span><span class="op">)</span>
<span class="fu">terra</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="fu">gdalio_terra</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">gdalio_im</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"\nspatstat"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-example1-1.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="resampling-algorithm">Resampling algorithm<a class="anchor" aria-label="anchor" href="#resampling-algorithm"></a>
</h3>
<p>In the same way, we can also use different methods of resampling and easily see the effect.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"mar"</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu">gdalio_stars</span><span class="op">(</span><span class="va">f</span>, resample <span class="op">=</span> <span class="st">"cubicspline"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">26</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">lz</span> <span class="op">&lt;-</span> <span class="fu">gdalio_stars</span><span class="op">(</span><span class="va">f</span>, resample <span class="op">=</span> <span class="st">"near"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">26</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="va">cs</span> <span class="op">-</span> <span class="va">lz</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">op</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-example-resample-1.png" width="100%"></p>
</div>
</div>
<div class="section level2">
<h2 id="imagery">Imagery<a class="anchor" aria-label="anchor" href="#imagery"></a>
</h2>
<p>This works as well for online image sources (like photos or street maps).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">virtualearth_imagery</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".xml"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="st">'&lt;GDAL_WMS&gt;
  &lt;Service name="VirtualEarth"&gt;
    &lt;ServerUrl&gt;http://a${server_num}.ortho.tiles.virtualearth.net/tiles/a${quadkey}.jpeg?g=90&lt;/ServerUrl&gt;
  &lt;/Service&gt;
  &lt;MaxConnections&gt;4&lt;/MaxConnections&gt;
  &lt;Cache/&gt;
&lt;/GDAL_WMS&gt;'</span>, <span class="va">virtualearth_imagery</span><span class="op">)</span>

<span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">gdalio_raster</span><span class="op">(</span><span class="va">virtualearth_imagery</span>, bands <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-imagery-1.png" width="100%"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## let's really zoom in on somewhere cool</span>
<span class="va">grid1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2e3</span>,
                             dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">512</span>, <span class="fl">512</span><span class="op">)</span>, 
                             projection <span class="op">=</span> <span class="st">"+proj=laea +lon_0=147.325 +lat_0=-42.880556"</span><span class="op">)</span>
<span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="va">grid1</span><span class="op">)</span>
<span class="va">img</span> <span class="op">&lt;-</span> <span class="fu">gdalio_raster</span><span class="op">(</span><span class="va">virtualearth_imagery</span>, bands <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu">plotRGB</span><span class="op">(</span><span class="va">img</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-imagery-2.png" width="100%"></p>
<p>To obtain the raw data values we can use <code><a href="reference/gdalio_data_rgb.html">gdalio_data_rgb()</a></code> or <code><a href="reference/gdalio_data_rgb.html">gdalio_data_hex()</a></code> without specifying the number of bands, but these are a little experimental for now.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rgbvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data_rgb.html">gdalio_data_rgb</a></span><span class="op">(</span><span class="va">virtualearth_imagery</span><span class="op">)</span>
<span class="va">hexvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data_rgb.html">gdalio_data_hex</a></span><span class="op">(</span><span class="va">virtualearth_imagery</span><span class="op">)</span></code></pre></div>
<p>We can use this to drive R’s own raster type, the <code><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">grDevices::as.raster()</a></code> array.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">arr</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_graphics</a></span><span class="op">(</span><span class="va">virtualearth_imagery</span><span class="op">)</span>
<span class="va">grid1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_get_default_grid.html">gdalio_get_default_grid</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">grid1</span><span class="op">$</span><span class="va">extent</span>, <span class="fl">2</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"n"</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="va">arr</span>, <span class="va">grid1</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">grid1</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">grid1</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">grid1</span><span class="op">$</span><span class="va">extent</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-grDevices-raster-1.png" width="100%"></p>
<p>Using R itself we can <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> but we must use a different idiom for the extent.</p>
<p><em>Don’t use <code>plot(arr, xlim = ,ylim = )</code> it does not work as claimed we can only get sensible extents at R version 4.1.0 with <code><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage()</a></code>.</em></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">arr</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-dum-raster-1.png" width="100%"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="st">"usr"</span><span class="op">)</span>
<span class="co">#&gt; [1] -191.1688  703.1688    0.0000  512.0000</span></code></pre></div>
<p>Another great example off twitter.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">u</span> <span class="op">&lt;-</span> <span class="st">"WMS:https://tiles.maps.eox.at/?SERVICE=WMS&amp;VERSION=1.1.1&amp;REQUEST=GetMap&amp;LAYERS=s2cloudless-2019&amp;SRS=EPSG:4326&amp;BBOX=-180.000000,-90.000000,180.000000,90.000000&amp;FORMAT=image/png&amp;TILESIZE=256&amp;OVERVIEWCOUNT=17&amp;MINRESOLUTION=0.0000053644180298&amp;TILED=true"</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hypertidy/gdalio" class="external-link">gdalio</a></span><span class="op">)</span> <span class="co">## https://github.com/hypertidy/gdalio</span>
<span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1e6</span>, 
                             dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1024</span>, <span class="fl">1024</span><span class="op">)</span>, 
                             projection <span class="op">=</span> <span class="st">"+proj=laea +lon_0=139 +lat_0=39"</span><span class="op">)</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/gdalio_data.html">gdalio_graphics</a></span><span class="op">(</span><span class="va">u</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-twitter-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="default-grid-there-is-one">Default grid (there is one)<a class="anchor" aria-label="anchor" href="#default-grid-there-is-one"></a>
</h2>
<p>Say we don’t set a grid at all, just go a default. Currently gdalio has a default for an entire world longlat grid. This means we can read from any source and we’ll get something (though we might not see anything if the source is a tiny region).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu">terra</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="fu">gdalio_terra</span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-default-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="miscellaneous">Miscellaneous<a class="anchor" aria-label="anchor" href="#miscellaneous"></a>
</h2>
<p>Some sources, files in spData, image servers, etc.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elevation.tiles.prod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".xml"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="st">'&lt;GDAL_WMS&gt;
  &lt;Service name="TMS"&gt;
    &lt;ServerUrl&gt;https://s3.amazonaws.com/elevation-tiles-prod/geotiff/${z}/${x}/${y}.tif&lt;/ServerUrl&gt;
  &lt;/Service&gt;
  &lt;DataWindow&gt;
    &lt;UpperLeftX&gt;-20037508.34&lt;/UpperLeftX&gt;
    &lt;UpperLeftY&gt;20037508.34&lt;/UpperLeftY&gt;
    &lt;LowerRightX&gt;20037508.34&lt;/LowerRightX&gt;
    &lt;LowerRightY&gt;-20037508.34&lt;/LowerRightY&gt;
    &lt;TileLevel&gt;14&lt;/TileLevel&gt;
    &lt;TileCountX&gt;1&lt;/TileCountX&gt;
    &lt;TileCountY&gt;1&lt;/TileCountY&gt;
    &lt;YOrigin&gt;top&lt;/YOrigin&gt;
  &lt;/DataWindow&gt;
  &lt;Projection&gt;EPSG:3857&lt;/Projection&gt;
  &lt;BlockSizeX&gt;512&lt;/BlockSizeX&gt;
  &lt;BlockSizeY&gt;512&lt;/BlockSizeY&gt;
  &lt;BandsCount&gt;1&lt;/BandsCount&gt;
  &lt;DataType&gt;Int16&lt;/DataType&gt;
  &lt;ZeroBlockHttpCodes&gt;403,404&lt;/ZeroBlockHttpCodes&gt;
  &lt;DataValues&gt;
    &lt;NoData&gt;-32768&lt;/NoData&gt;
  &lt;/DataValues&gt;
  &lt;Cache/&gt;
&lt;/GDAL_WMS&gt;'</span>, <span class="va">elevation.tiles.prod</span><span class="op">)</span>

<span class="co">## we'll use this as a grid specification, not the actual data for anything</span>
<span class="va">sfiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"raster"</span>, package <span class="op">=</span> <span class="st">"spDataLarge"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">## we don't take raster objects, just the spec: extent, dim, projection</span>
<span class="va">ri</span> <span class="op">&lt;-</span> <span class="fu">vapour</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vapour/man/vapour_raster_info.html" class="external-link">vapour_raster_info</a></span><span class="op">(</span><span class="va">sfiles</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="va">ri</span><span class="op">$</span><span class="va">extent</span>, 
                             dimension <span class="op">=</span> <span class="va">ri</span><span class="op">$</span><span class="va">dimXY</span>, 
                             projection <span class="op">=</span> <span class="va">ri</span><span class="op">$</span><span class="va">projection</span><span class="op">)</span><span class="op">)</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">gdalio_stars</span><span class="op">(</span><span class="va">elevation.tiles.prod</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/" class="external-link">stars</a></span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: abind</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.10.1, GDAL 3.4.0, PROJ 8.2.0; sf_use_s2() is TRUE</span></code></pre></div>
<p><img src="reference/figures/README-example-data-1.png" width="100%"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co">## we can do this anywhere, in any projection but it depends on what our source *has* of course</span>
<span class="co">## but, it's pretty general and powerful</span>
<span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3e6</span>, 
                             dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">768</span>, <span class="fl">813</span><span class="op">)</span>, 
                             projection <span class="op">=</span> <span class="st">"+proj=stere +lat_0=-65 +lon_0=147"</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">gdalio_im</span><span class="op">(</span><span class="va">elevation.tiles.prod</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-example-data-2.png" width="100%"></p>
<p>My favourite projection family (I think) is Oblique Mercator. For a long time I’ve wanted this kind of freedom and convenience for working with spatial data … rather than constantly juggling objects and formats and plumbing, more to come. :)</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">omerc</span> <span class="op">&lt;-</span> <span class="st">"+proj=omerc +lonc=147 +gamma=9 +alpha=9 +lat_0=-10 +ellps=WGS84"</span>

<span class="fu"><a href="reference/gdalio_set_default_grid.html">gdalio_set_default_grid</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>extent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fl">7e6</span>, 
                             dimension <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">768</span>, <span class="fl">813</span><span class="op">)</span>, 
                             projection <span class="op">=</span> <span class="va">omerc</span><span class="op">)</span><span class="op">)</span>

<span class="va">o</span> <span class="op">&lt;-</span> <span class="fu">gdalio_raster</span><span class="op">(</span><span class="va">elevation.tiles.prod</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">o</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">52</span><span class="op">)</span><span class="op">)</span>
<span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu">reproj</span><span class="fu">::</span><span class="fu">reproj</span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu">coordinates</span><span class="op">(</span><span class="va">o</span><span class="op">)</span>, <span class="st">"+proj=longlat"</span>, source <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu">projection</span><span class="op">(</span><span class="va">o</span><span class="op">)</span><span class="op">)</span>
<span class="va">xy</span><span class="op">[</span><span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span><span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">360</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: sp</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu">setValues</span><span class="op">(</span><span class="va">o</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="fu">setValues</span><span class="op">(</span><span class="va">o</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-omerc-1.png" width="100%"></p>
<p>The fun part is I can now change the source, I’ve already set up the map I want and I can simply ask for a new set of pixels. The topography data happens to be in Mercator from a tiled and level of detail image service, while the SST is from a model output format (NetCDF) at a single resolution. GDAL doesn’t care! Let’s make them the same:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sst</span> <span class="op">&lt;-</span> <span class="fu">gdalio_raster</span><span class="op">(</span><span class="va">f</span><span class="op">)</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu">plot</span><span class="op">(</span><span class="va">sst</span>, col <span class="op">=</span> <span class="fu">palr</span><span class="fu">::</span><span class="fu">sst_pal</span><span class="op">(</span><span class="fl">26</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="fu">setValues</span><span class="op">(</span><span class="va">o</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="fu">setValues</span><span class="op">(</span><span class="va">o</span>, <span class="va">xy</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span><span class="va">o</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, labels <span class="op">=</span> <span class="st">""</span>, col <span class="op">=</span> <span class="st">"black"</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4500</span>, by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-netcdf-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the gdalio project is released with a <a href="https://contributor-covenant.org/version/2/0/CODE_OF_CONDUCT.html" class="external-link">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/hypertidy/gdalio/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/hypertidy/gdalio/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing gdalio</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Michael D. Sumner <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/hypertidy/gdalio/actions" class="external-link"><img src="https://github.com/hypertidy/gdalio/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
